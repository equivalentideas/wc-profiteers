%h1 Who profits from WestConnex?
%p.lede
  These #{@contractors.count} companies have been contracted by the NSW Government.
  So far, their #{pluralize(Contract.count, "contracts")} are worth #{number_to_currency(Contract.sum(:value), precision: 0)}.
%ul.contractors
  - @contractors.each do |contractor|
    %li.contractor
      %header
        %h2.contractor-name= contractor.name
        %span.contractor-value= number_to_currency(contractor.total_est_contract_value, precision: 0)
        .item-data
          - # TODO change to generic item data group class
          - if contractor.acn
            %dl.item-data-group
              %dt ACN
              %dd= link_to contractor.acn, "https://connectonline.asic.gov.au/RegistrySearch/faces/landing/panelSearch.jspx?searchType=OrgAndBusNm&searchText=#{contractor.acn}", title: "View record on the ASIC website."
          - if contractor.abn
            %dl.item-data-group
              %dt ABN
              %dd= link_to contractor.abn, "http://www.abr.business.gov.au/SearchByAbn.aspx?SearchText=#{contractor.abn}", title: "Look this ABN up on the Australian Business Register."
          - if contractor.website
            %dl.item-data-group
              %dt Website
              %dd= link_to simple_url(contractor.website), contractor.website, class: 'contractor-website'
      %ul.contracts
        - contractor.contracts.each do |contract|
          %li.contract
            %p.contract-description
              = link_to(contract.description, contract.url, title: "View the contract listing at tenders.gov.nsw")
            .item-data
              %dl.item-data-group
                %dt Value:
                %dd.contract-value #{number_to_currency(contract.value, precision: 0)}
              %dl.item-data-group
                %dt Period:
                %dd.contract-duration #{contract.start_date} â€“ #{contract.end_date}
